@page "/services"
@inject IServiceApiService ServiceService
@inject ICategoryService   CategoryService

<PageTitle>Services â€” Bookify</PageTitle>

<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-10">
    <!-- Header -->
    <div class="mb-8">
        <h1 class="text-3xl font-bold text-gray-900">All Services</h1>
        <p class="text-gray-400 mt-1">Browse and book from our range of professional services</p>
    </div>

    <!-- Search + Filter Row -->
    <div class="flex flex-col sm:flex-row gap-4 mb-6">
        <div class="relative flex-1">
            <svg class="absolute left-3.5 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"
                 fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
            </svg>
            <input @bind="_search" @bind:event="oninput" type="text"
                   placeholder="Search services..."
                   class="w-full pl-10 pr-4 py-3 rounded-xl border border-gray-200 focus:outline-none focus:ring-2 focus:ring-primary-300 text-sm" />
        </div>
    </div>

    <!-- Category Pills -->
    @if (_categories.Count > 0)
    {
        <div class="flex gap-2 flex-wrap mb-8">
            <button @onclick="() => _selectedCategoryId = null"
                    class="px-4 py-2 rounded-full text-sm font-medium transition-all
                           @(_selectedCategoryId == null ? "bg-primary-600 text-white shadow-sm" : "bg-gray-100 text-gray-600 hover:bg-primary-50 hover:text-primary-600")">
                All
            </button>
            @foreach (var cat in _categories)
            {
                <button @onclick="() => _selectedCategoryId = cat.Id"
                        class="px-4 py-2 rounded-full text-sm font-medium transition-all
                               @(_selectedCategoryId == cat.Id ? "bg-primary-600 text-white shadow-sm" : "bg-gray-100 text-gray-600 hover:bg-primary-50 hover:text-primary-600")">
                    @cat.Icon @cat.Name
                </button>
            }
        </div>
    }

    <!-- Grid -->
    @if (_loading)
    {
        <LoadingSpinner Message="Loading services..." />
    }
    else if (FilteredServices.Count == 0)
    {
        <EmptyState Icon="ðŸ”" Title="No services found"
                    Message="Try adjusting your search or category filter." />
    }
    else
    {
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
            @foreach (var svc in FilteredServices)
            {
                <ServiceCard Service="svc" />
            }
        </div>
        <p class="text-sm text-gray-400 text-right mt-4">
            @FilteredServices.Count service(s)
        </p>
    }
</div>

@code {
    private List<ServiceModel>  _services          = [];
    private List<CategoryModel> _categories        = [];
    private bool                _loading           = true;
    private string              _search            = string.Empty;
    private Guid?               _selectedCategoryId;

    private List<ServiceModel> FilteredServices => _services
        .Where(s => !s.IsDeleted &&
                    (string.IsNullOrEmpty(_search) ||
                     s.Name.Contains(_search, StringComparison.OrdinalIgnoreCase) ||
                     s.Description.Contains(_search, StringComparison.OrdinalIgnoreCase)) &&
                    (_selectedCategoryId == null || s.CategoryId == _selectedCategoryId))
        .ToList();

    protected override async Task OnInitializedAsync()
    {
        var catTask = CategoryService.GetAllAsync();
        var svcTask = ServiceService.GetAllAsync();
        _categories = await catTask;
        _services   = await svcTask;
        _loading    = false;
    }
}
